---
title: 异步
order: 3
type: special
---

> [参考](https://github.com/getify/You-Dont-Know-JS/blob/master/preface.md)

## 事件轮询

- js并没有异步的概念，所看到的异步只不过是代码块的一段段执行，随着时间推移，也就有了所谓的异步

- js是单线程的，轮询队列中的事件会一个个被执行，setTimeout不会一开始就把回调放入轮询队列中，而是到了指定的时间之后会将回调放入轮询队列中，如果此时轮询队列中有了多个事件，它会排在这些事件之后执行，这也会导致定时器没那么准时

- 直到最近，这种情况才发生了改变，es6现在明确指出了事件轮询应当如何工作，而不是取决于宿主环境

## Jobs

- 稍后，但尽快

- 模拟代码
```js
console.log('A');
setTimeout( function(){
  console.log('B');
}, 0);
// 理论上的 'Job Api'
schedule( function() {
  console.log('C');
  schedule(function() {
    console.log('D');
  })
})
```

- expected：ABCD
- actual：ACDB

- 因为Job发生在当前的事件轮询tick的末尾，而定时器会在下一个事件轮询tick触发
- Promises的异步行为基于Job的，所以搞明白它与事件轮询行为的联系是很重要的